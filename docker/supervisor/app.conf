[program:swoole-server]
# Command để khởi động server Swoole của bạn.
# Lệnh này khởi động Swoole server ở foreground, phù hợp để chạy với Supervisor.
command=php /app/cli serve:start

process_name=%(program_name)s_%(process_num)02d
autostart=true
autorestart=true
user=appuser
numprocs=1

# --- PHẦN QUAN TRỌNG NHẤT ĐỂ FIX LOG ---
# Chuyển hướng stderr của tiến trình con vào stdout của Supervisor.
redirect_stderr=true
# Chuyển hướng stdout của Supervisor ra output chuẩn của container.
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

[program:queue-worker]
command=php /app/cli queue:work
process_name=%(program_name)s_%(process_num)02d
autostart=true
autorestart=true
user=appuser
numprocs=1 ; Bạn có thể tăng số lượng worker nếu cần xử lý nhiều job
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
redirect_stderr=true
